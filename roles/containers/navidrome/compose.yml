networks:
  proxy:
    external: true

services:
  navidrome:
    image: deluan/navidrome:0.59.0
    ports:
      - "4533:4533"
    restart: unless-stopped
    networks:
    - proxy
    environment:
      ND_SCANSCHEDULE: 1h
      ND_LOGLEVEL: info  
      ND_SESSIONTIMEOUT: 24h
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.navidrome.rule=Host(`navidrome.{{ local_domain }}`)"
      - "traefik.http.routers.navidrome.entrypoints=https"
    volumes:
      - data:/data"
      - music:/music:ro"

volumes:
  data:
  music:
    driver: local
    driver_opts:
      type: nfs
      o: "addr={{ hostvars['nas1'].ansible_host }},rw,nolock,soft,timeo=30,vers=4.0"
      device: ":/mnt/truenas/nas/data/media/music"